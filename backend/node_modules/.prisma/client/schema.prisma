generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  STUDENT
  PARENT
  TEACHER
  ADMIN
  STAFF
}

enum OrderStatus {
  PENDING_PAYMENT
  PAID
  PROCESSING
  READY_FOR_PICKUP
  COMPLETED
  CANCELLED
}

enum PaymentMethod {
  ONLINE
  CASH_ON_PICKUP
}

enum PaymentStatus {
  UNPAID
  PENDING
  PAID
  FAILED
  REFUNDED
}

enum PaymentProvider {
  GENERIC
  GCASH
  PAYPAL
}

model User {
  id           String  @id @default(cuid())
  email        String  @unique
  passwordHash String
  fullName     String
  role         Role
  studentId    String? @unique
  gradeLevel   String?
  section      String?

  orders Order[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ProductCategory {
  id          String  @id @default(cuid())
  name        String
  description String?
  isActive    Boolean @default(true)

  products Product[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Product {
  id          String          @id @default(cuid())
  categoryId  String
  category    ProductCategory @relation(fields: [categoryId], references: [id])
  name        String
  description String?
  imageUrl    String?
  basePrice   Decimal         @db.Decimal(10, 2)
  isActive    Boolean         @default(true)

  variants   ProductVariant[]
  orderItems OrderItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ProductVariant {
  id            String   @id @default(cuid())
  productId     String
  product       Product  @relation(fields: [productId], references: [id])
  name          String
  sku           String   @unique
  price         Decimal? @db.Decimal(10, 2)
  stockQuantity Int      @default(0)

  orderItems OrderItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Order {
  id             String        @id @default(cuid())
  userId         String
  user           User          @relation(fields: [userId], references: [id])
  status         OrderStatus   @default(PENDING_PAYMENT)
  paymentMethod  PaymentMethod
  paymentStatus  PaymentStatus @default(UNPAID)
  totalAmount    Decimal       @db.Decimal(10, 2)
  pickupLocation String?
  pickupSchedule DateTime?

  items   OrderItem[]
  payment Payment?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model OrderItem {
  id        String          @id @default(cuid())
  orderId   String
  order     Order           @relation(fields: [orderId], references: [id])
  productId String
  product   Product         @relation(fields: [productId], references: [id])
  variantId String?
  variant   ProductVariant? @relation(fields: [variantId], references: [id])
  quantity  Int
  unitPrice Decimal         @db.Decimal(10, 2)
  lineTotal Decimal         @db.Decimal(10, 2)
}

model Payment {
  id                String          @id @default(cuid())
  orderId           String          @unique
  order             Order           @relation(fields: [orderId], references: [id])
  provider          PaymentProvider @default(GENERIC)
  providerReference String?
  amount            Decimal         @db.Decimal(10, 2)
  status            PaymentStatus   @default(PENDING)
  paidAt            DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
